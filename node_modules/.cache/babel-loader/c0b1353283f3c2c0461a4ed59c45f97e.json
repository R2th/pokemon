{"ast":null,"code":"import _objectSpread from\"E:/Desktop/game-pikachu-v2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"E:/Desktop/game-pikachu-v2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useRef,useState}from\"react\";import{useTranslation}from\"react-i18next\";import{useRecoilState,useRecoilValue}from\"recoil\";import{useGameActions}from\"../../hooks/useGameActions\";import gameOverlayState from\"../../recoil/atoms/gameOverlayState\";import gameSoundState from\"../../recoil/atoms/gameSoundState\";import gameState from\"../../recoil/atoms/gameState\";import playerState from\"../../recoil/atoms/playerState\";import{BASE_START_TIME,BONUS_TIME,GameMode,GameStatus,PENALTY_TIME,PENDING_TIME,SUGGEST_TIME}from\"../../types/game\";import{hasAnyConnectLine}from\"../../utils/game\";import{timeConvert}from\"../../utils/time\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var GameSurvivalTiming=function GameSurvivalTiming(_ref){var _ref$hasTiming=_ref.hasTiming,hasTiming=_ref$hasTiming===void 0?false:_ref$hasTiming;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useRecoilValue=useRecoilValue(gameState),status=_useRecoilValue.status,pokemons=_useRecoilValue.pokemons,matrix=_useRecoilValue.matrix,row=_useRecoilValue.row,col=_useRecoilValue.col;var _useRecoilValue2=useRecoilValue(gameSoundState),playRisingPopSound=_useRecoilValue2.playRisingPopSound,playGlugSound=_useRecoilValue2.playGlugSound;var _useState=useState(0),_useState2=_slicedToArray(_useState,2),timingState=_useState2[0],setTimingState=_useState2[1];var timing=useRef(0);var remainTiming=useRef(BASE_START_TIME);var pendingTiming=useRef(PENDING_TIME);var suggestTiming=useRef(0);var _useRecoilState=useRecoilState(playerState),_useRecoilState2=_slicedToArray(_useRecoilState,2),currentPlayer=_useRecoilState2[0],setPlayer=_useRecoilState2[1];var _useGameActions=useGameActions(GameMode.SURVIVAL_MODE),endGame=_useGameActions.endGame,startGame=_useGameActions.startGame;var _useRecoilState3=useRecoilState(gameOverlayState),_useRecoilState4=_slicedToArray(_useRecoilState3,2),connectingLinePoints=_useRecoilState4[0].connectingLinePoints,setGameOverlay=_useRecoilState4[1];// count timing when running, stop when completed\nuseEffect(function(){var timeoutId=undefined;if(status===GameStatus.PENDING&&hasTiming){timing.current=0;remainTiming.current=BASE_START_TIME;}if(status===GameStatus.RUNNING){if(hasTiming){if(suggestTiming.current>=SUGGEST_TIME){var _hasAnyConnectLine=hasAnyConnectLine(pokemons,matrix,row,col),foundConnectLine=_hasAnyConnectLine.foundConnectLine,fromPoint=_hasAnyConnectLine.fromPoint,toPoint=_hasAnyConnectLine.toPoint;if(foundConnectLine){setGameOverlay(function(gameOverlay){return _objectSpread(_objectSpread({},gameOverlay),{},{suggestPoints:[fromPoint,toPoint]});});}suggestTiming.current=0;}}if(remainTiming.current<=0){if(hasTiming){endGame();}}else{timeoutId=setTimeout(function(){timing.current++;suggestTiming.current++;remainTiming.current--;setTimingState(timingState+1);},1000);}}// update timing to make score\nif(status===GameStatus.COMPLETED){if(timeoutId)clearTimeout(timeoutId);}return function(){timeoutId&&clearTimeout(timeoutId);};},[status,timingState]);useEffect(function(){var intervalId=undefined;if(status===GameStatus.PENDING){if(hasTiming){setGameOverlay(function(gameOverlay){return _objectSpread(_objectSpread({},gameOverlay),{},{suggestPoints:[undefined,undefined]});});}timing.current=0;pendingTiming.current=PENDING_TIME;var countdownEl=document.getElementById(\"count-down-pending-timing\");if(countdownEl)countdownEl.innerText=pendingTiming.current.toString();intervalId=setInterval(function(){if(pendingTiming.current<=1){intervalId&&clearInterval(intervalId);pendingTiming.current=PENDING_TIME;startGame();}else{pendingTiming.current--;}var countdownEl=document.getElementById(\"count-down-pending-timing\");if(countdownEl)countdownEl.innerText=pendingTiming.current.toString();},1000);}if(status===GameStatus.COMPLETED){intervalId&&clearInterval(intervalId);if(hasTiming){setPlayer(_objectSpread(_objectSpread({},currentPlayer),{},{playerTiming:timing.current}));}}return function(){pendingTiming.current=PENDING_TIME;intervalId&&clearInterval(intervalId);};},[status]);// check rule time\nuseEffect(function(){if(connectingLinePoints.length===1){playGlugSound&&playGlugSound();remainTiming.current-=PENALTY_TIME;}if(connectingLinePoints.length>1){playRisingPopSound&&playRisingPopSound();remainTiming.current+=BONUS_TIME;suggestTiming.current=0;}},[connectingLinePoints]);return/*#__PURE__*/_jsxs(_Fragment,{children:[!hasTiming&&/*#__PURE__*/_jsx(\"div\",{id:\"count-down-pending-timing\",className:\"overlay-pending-timing\",children:pendingTiming.current}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-center\",children:[t(\"Your time\"),\": \",timeConvert(timing.current)]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-center\",children:[t(\"Remaining time\"),\": \",timeConvert(remainTiming.current)]})]});};export default GameSurvivalTiming;","map":{"version":3,"sources":["E:/Desktop/game-pikachu-v2/src/components/Game/GameSurvivalTiming.tsx"],"names":["useEffect","useRef","useState","useTranslation","useRecoilState","useRecoilValue","useGameActions","gameOverlayState","gameSoundState","gameState","playerState","BASE_START_TIME","BONUS_TIME","GameMode","GameStatus","PENALTY_TIME","PENDING_TIME","SUGGEST_TIME","hasAnyConnectLine","timeConvert","GameSurvivalTiming","hasTiming","t","status","pokemons","matrix","row","col","playRisingPopSound","playGlugSound","timingState","setTimingState","timing","remainTiming","pendingTiming","suggestTiming","currentPlayer","setPlayer","SURVIVAL_MODE","endGame","startGame","connectingLinePoints","setGameOverlay","timeoutId","undefined","PENDING","current","RUNNING","foundConnectLine","fromPoint","toPoint","gameOverlay","suggestPoints","setTimeout","COMPLETED","clearTimeout","intervalId","countdownEl","document","getElementById","innerText","toString","setInterval","clearInterval","playerTiming","length"],"mappings":"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","sourcesContent":["import { FC, useEffect, useRef, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useRecoilState, useRecoilValue } from \"recoil\";\r\nimport { useGameActions } from \"../../hooks/useGameActions\";\r\nimport gameOverlayState from \"../../recoil/atoms/gameOverlayState\";\r\nimport gameSoundState from \"../../recoil/atoms/gameSoundState\";\r\nimport gameState from \"../../recoil/atoms/gameState\";\r\nimport playerState from \"../../recoil/atoms/playerState\";\r\nimport {\r\n  BASE_START_TIME,\r\n  BONUS_TIME,\r\n  GameMode,\r\n  GameStatus,\r\n  PENALTY_TIME,\r\n  PENDING_TIME,\r\n  SUGGEST_TIME,\r\n} from \"../../types/game\";\r\nimport { hasAnyConnectLine } from \"../../utils/game\";\r\nimport { timeConvert } from \"../../utils/time\";\r\n\r\nconst GameSurvivalTiming: FC<{ hasTiming: boolean }> = ({\r\n  hasTiming = false,\r\n}) => {\r\n  const { t } = useTranslation();\r\n  const { status, pokemons, matrix, row, col } = useRecoilValue(gameState);\r\n  const { playRisingPopSound, playGlugSound } = useRecoilValue(gameSoundState);\r\n  const [timingState, setTimingState] = useState(0);\r\n  const timing = useRef(0);\r\n  const remainTiming = useRef(BASE_START_TIME);\r\n  const pendingTiming = useRef(PENDING_TIME);\r\n  const suggestTiming = useRef(0);\r\n  const [currentPlayer, setPlayer] = useRecoilState(playerState);\r\n  const { endGame, startGame } = useGameActions(GameMode.SURVIVAL_MODE);\r\n  const [{ connectingLinePoints }, setGameOverlay] =\r\n    useRecoilState(gameOverlayState);\r\n\r\n  // count timing when running, stop when completed\r\n  useEffect(() => {\r\n    let timeoutId: NodeJS.Timeout | undefined = undefined;\r\n\r\n    if (status === GameStatus.PENDING && hasTiming) {\r\n      timing.current = 0;\r\n      remainTiming.current = BASE_START_TIME;\r\n    }\r\n\r\n    if (status === GameStatus.RUNNING) {\r\n      if (hasTiming) {\r\n        if (suggestTiming.current >= SUGGEST_TIME) {\r\n          const { foundConnectLine, fromPoint, toPoint } = hasAnyConnectLine(\r\n            pokemons,\r\n            matrix,\r\n            row,\r\n            col\r\n          );\r\n          if (foundConnectLine) {\r\n            setGameOverlay((gameOverlay) => ({\r\n              ...gameOverlay,\r\n              suggestPoints: [fromPoint, toPoint],\r\n            }));\r\n          }\r\n          suggestTiming.current = 0;\r\n        }\r\n      }\r\n      if (remainTiming.current <= 0) {\r\n        if (hasTiming) {\r\n          endGame();\r\n        }\r\n      } else {\r\n        timeoutId = setTimeout(() => {\r\n          timing.current++;\r\n          suggestTiming.current++;\r\n          remainTiming.current--;\r\n          setTimingState(timingState + 1);\r\n        }, 1000);\r\n      }\r\n    }\r\n\r\n    // update timing to make score\r\n    if (status === GameStatus.COMPLETED) {\r\n      if (timeoutId) clearTimeout(timeoutId);\r\n    }\r\n    return () => {\r\n      timeoutId && clearTimeout(timeoutId);\r\n    };\r\n  }, [status, timingState]);\r\n\r\n  useEffect(() => {\r\n    let intervalId: NodeJS.Timeout | undefined = undefined;\r\n    if (status === GameStatus.PENDING) {\r\n      if (hasTiming) {\r\n        setGameOverlay((gameOverlay) => ({\r\n          ...gameOverlay,\r\n          suggestPoints: [undefined, undefined],\r\n        }));\r\n      }\r\n      timing.current = 0;\r\n      pendingTiming.current = PENDING_TIME;\r\n      const countdownEl = document.getElementById(\"count-down-pending-timing\");\r\n      if (countdownEl) countdownEl.innerText = pendingTiming.current.toString();\r\n      intervalId = setInterval(() => {\r\n        if (pendingTiming.current <= 1) {\r\n          intervalId && clearInterval(intervalId);\r\n          pendingTiming.current = PENDING_TIME;\r\n          startGame();\r\n        } else {\r\n          pendingTiming.current--;\r\n        }\r\n        const countdownEl = document.getElementById(\r\n          \"count-down-pending-timing\"\r\n        );\r\n        if (countdownEl)\r\n          countdownEl.innerText = pendingTiming.current.toString();\r\n      }, 1000);\r\n    }\r\n\r\n    if (status === GameStatus.COMPLETED) {\r\n      intervalId && clearInterval(intervalId);\r\n      if (hasTiming) {\r\n        setPlayer({ ...currentPlayer, playerTiming: timing.current });\r\n      }\r\n    }\r\n    return () => {\r\n      pendingTiming.current = PENDING_TIME;\r\n      intervalId && clearInterval(intervalId);\r\n    };\r\n  }, [status]);\r\n\r\n  // check rule time\r\n  useEffect(() => {\r\n    if (connectingLinePoints.length === 1) {\r\n      playGlugSound && playGlugSound();\r\n      remainTiming.current -= PENALTY_TIME;\r\n    }\r\n    if (connectingLinePoints.length > 1) {\r\n      playRisingPopSound && playRisingPopSound();\r\n      remainTiming.current += BONUS_TIME;\r\n      suggestTiming.current = 0;\r\n    }\r\n  }, [connectingLinePoints]);\r\n\r\n  return (\r\n    <>\r\n      {!hasTiming && (\r\n        <div id=\"count-down-pending-timing\" className=\"overlay-pending-timing\">\r\n          {pendingTiming.current}\r\n        </div>\r\n      )}\r\n      <p className=\"text-center\">\r\n        {t(\"Your time\")}: {timeConvert(timing.current)}\r\n      </p>\r\n      <p className=\"text-center\">\r\n        {t(\"Remaining time\")}: {timeConvert(remainTiming.current)}\r\n      </p>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default GameSurvivalTiming;\r\n"]},"metadata":{},"sourceType":"module"}